<?phpfunction action_sort($a, $b) {    return $a['priority'] > $b['priority'] ? 1 : -1;}$actions = array();function add_action($actionname, $function, $params = array(), $priority = 10){global $actions;$actions[$actionname][$function] = array("name" => $function,"parameter" => $params,"priority" => $priority);uasort($actions[$actionname], 'action_sort');}function run_action($actionname, $transfered_params = array()){	global $actions;	//loop to every action with should get processed	foreach($actions[$actionname] as $action){		$params = array();		//Binding the parameters to the function		foreach($action["parameter"] as $key => $parameter){		//function that allows run_action to return values to the function		if('transferred-keys' == $key && !is_int($key)){			if(gettype($parameter) == 'array'){				$transferred_keys = array_flip($parameter);				$return_array = array_merge($transferred_keys, $transfered_params);				foreach($return_array as $return_key => $return_parameter){				//sorts out every variables wich don't need to get returned					if(in_array($return_key, $parameter)){						$params[] = $return_parameter;					}				}			}		}else{			$params[] = $parameter;		}		}		call_user_func_array($action["name"], $params);	}}add_action("before-js-loaded", "add_setting_js", array("Hell ya", "endlich"));$post_id = 86;function add_setting_js($source, $param = "not important"){echo "$source will get importet!";}function email_friends(){ echo "friends get emailed!"; echo "<br>"; echo "<br>";}function check_if_virus($crap, $post_name, $crap2){print_r($post_name);echo "<br>"; echo "Virus? no!"; echo "<br>"; echo "<br>";}add_action('publish_post', 'check_if_virus', array("crap", "transferred-keys" => array("post-name"), "crap2"));add_action('publish_post', 'email_friends');run_action("publish_post", array("post-id" => $post_id, "post-name" => "Hallo Welt!"));?>