<?phpsession_start();include("../loader.php");?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="EN" lang="EN" dir="ltr"><head profile="http://gmpg.org/xfn/11"><meta charset="utf-8"><title><?php echo sprintf(_t("%s > backend"), "widget"); ?></title></head><body><?phpinclude_once(dirname(__file__)."/backend_UI.php");?><div id="contentframe"><table>	<thead>		<tr>			<th tabindex="0" rowspan="1" colspan="1" style="width: 200px;"><?php echo _t("widget name"); ?></th>			<th tabindex="0" rowspan="1" colspan="1" style="width: 170px;"><?php echo _t("sites"); ?></th>			<th tabindex="0" rowspan="1" colspan="1" style="width: 170px;"><?php echo _t("positions"); ?></th>		</tr>	</thead> 	<tbody><?php$old_chdir = getcwd();chdir(SERVER_DIR);$sql_query_condition_arr = array();if($handle = opendir("widgets/")) {	while (false !== ($entry = readdir($handle))) {		if($entry != "." && $entry != "..") {			$sql_query_condition_arr[] .= "`widget` = '".$entry."'";		}	}	closedir($handle);}$sql_query_condition_string = "(".implode(" OR ", $sql_query_condition_arr).")";$sql_query = "SELECT * from `".$dbprae."pagemeta` WHERE ".$sql_query_condition_string." GROUP by `widget`;";$widget = new mysql();$widget_result = $widget->query($sql_query);while($existing_widgets = $widget->result($widget_result, "assoc")){	$affected_pageID = array();	$position = array();	$fallback_position = array();	$multiple_pages = new mysql();	$multiple_pages_result = $multiple_pages->query("SELECT affected_pageID, position, fallback_position FROM `".$dbprae."pagemeta` WHERE `widget` = '".$existing_widgets["widget"]."';");	while($multiple_pages_return = $multiple_pages->result($multiple_pages_result, "assoc")){		$affected_pageID[] = $multiple_pages_return["affected_pageID"];		if($multiple_pages_return["fallback_position"] != ""){		$position[] = $multiple_pages_return["position"]." (".$multiple_pages_return["fallback_position"].")";		}else{		$position[] = $multiple_pages_return["position"];		}	}	?><tr><td><?phpecho $existing_widgets["widget"];chdir(SERVER_DIR); // just for savetyif(file_exists("widgets/".$existing_widgets["widget"]."/backend.php")){echo "<a style='text-decoration: none;' href='widgets-setting-edit.php?widget=".$existing_widgets["widget"]."'><span class='label-warning'>edit</span></a>";}?></td><td><?php echo implode("<hr>", $affected_pageID); ?></td><td><?php echo implode("<hr>", $position); ?></td></tr><?php}print_r($existing_widgets);chdir($old_chdir);?></tbody></table> </div></body></html>